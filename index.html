<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORT Sight Word Explorer - English</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js for sound -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.min.js"></script>
    <style>
        /* Inter font and mobile optimization */
        body { font-family: 'Inter', sans-serif; background-color: #1f2937; color: white; }
        
        /* Main screen layout (no scroll) */
        .game-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
        }

        /* Large button styles */
        .mode-button, .answer-button {
            transition: transform 0.1s;
            box-shadow: 0 4px 0 0 #0f6c44; 
            min-height: 60px; 
            touch-action: manipulation;
        }
        .mode-button:active, .answer-button:active {
            transform: translateY(4px);
            box-shadow: none; 
        }

        /* Menu button theme */
        .mode-button {
            background-color: #3b82f6; 
            box-shadow: 0 4px 0 0 #1e40af;
        }
        .mode-button:hover {
            background-color: #2563eb;
        }

        /* Spaceship animation */
        .spaceship {
            animation: bounce 2s infinite ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Question Display */
        #problemDisplay {
            font-size: 2.5rem; /* ê¸€ì í¬ê¸° ì¡°ì • (ë¬¸ì¥ ê¸¸ì´ì— ë§ì¶°) */
            line-height: 1.5;
        }
        .blank-space {
            color: #ffcc00; /* ë¹ˆì¹¸ ê°•ì¡° */
            font-weight: bold;
            text-decoration: underline;
        }
    </style>
</head>
<body class="bg-gray-900">

    <div id="app" class="game-screen w-full max-w-lg mx-auto">

        <!-- 1. Top Score and Mode Display -->
        <header class="w-full text-center space-y-2 flex-shrink-0">
            <h1 class="text-3xl font-extrabold text-yellow-400">ğŸš€ ORT ì˜ì–´ íƒí—˜ëŒ€ ğŸª</h1>
            <div class="flex justify-around bg-gray-800 p-3 rounded-xl shadow-lg">
                <span class="text-xl font-bold text-green-400">ì •ë‹µ ìˆ˜: <span id="score">0</span></span>
                <span class="text-xl font-bold text-blue-400">ëª¨ë“œ: <span id="currentModeName">ì„ íƒ í•„ìš”</span></span>
                <button onclick="showMenu()" class="text-sm font-semibold bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded">ë©”ë‰´</button>
            </div>
        </header>

        <!-- 2. Main Content Area (Problem or Menu) -->
        <main class="flex flex-col items-center justify-center space-y-4 flex-grow w-full text-center">
            
            <div id="gameArea" class="w-full h-full flex flex-col items-center justify-center space-y-8" style="display:none;">
                <div class="spaceship text-6xl flex-shrink-0">ğŸš€</div>
                
                <!-- ë¬¸ì œ í‘œì‹œ (ì˜ì–´ ë¬¸ì¥) -->
                <div id="problemDisplay" class="font-black bg-blue-900 p-6 rounded-3xl shadow-2xl border-4 border-blue-500 flex-shrink-0">
                    <!-- Problem loading area -->
                </div>

                <!-- ë©”ì‹œì§€ í”¼ë“œë°± -->
                <div id="feedbackMessage" class="text-3xl font-extrabold h-10 flex-shrink-0"></div>
            </div>

            <!-- ë©”ë‰´ í™”ë©´ -->
            <div id="menuArea" class="w-full p-4 bg-gray-800 rounded-xl shadow-2xl space-y-4">
                <h2 class="text-2xl font-bold text-yellow-300" id="welcomeMessage">â­ ì˜ì–´ ë‹¨ì–´ íƒí—˜ëŒ€ â­</h2>
                <div id="nameInputArea" class="space-y-3">
                    <p class="text-lg">ğŸ‘‹ íƒí—˜ê°€ë‹˜ì˜ ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”:</p>
                    <!-- text-gray-900ì€ ì…ë ¥ í…ìŠ¤íŠ¸ ìƒ‰ìƒ. JSì—ì„œ ì´ˆê¸° ìŠ¤íƒ€ì¼ë§ì„ ìœ„í•´ ID ì‚¬ìš© -->
                    <input type="text" id="userNameInput" placeholder="e.g. Biff or Kipper" class="w-full p-3 rounded-lg text-center text-xl text-gray-900" maxlength="10"> 
                    <button id="startButton" onclick="startNameEntry()" class="mode-button w-full p-3 text-2xl font-bold">ì´ë¦„ í™•ì • ë° ì‹œì‘</button>
                </div>
                
                <!-- ëª¨ë“œ ì„ íƒì€ ì´ë¦„ ì…ë ¥ í›„ ë‚˜íƒ€ë‚¨ -->
                <div id="modeSelectionArea" style="display:none;">
                    <h3 class="text-xl font-bold text-yellow-300 mb-3">ğŸ“š í•™ìŠµ ëª¨ë“œ ì„ íƒ (ORT Focus)</h3>
                    <div id="modeButtons" class="grid grid-cols-2 gap-3">
                        <!-- Buttons are loaded by JS -->
                    </div>
                </div>
            </div>
        </main>

        <!-- 3. í•˜ë‹¨ ë‹µë³€ ë²„íŠ¼ ê·¸ë¦¬ë“œ -->
        <footer id="answerFooter" class="w-full grid grid-cols-2 gap-3 flex-shrink-0" style="display:none;">
            <!-- ë‹µë³€ ë²„íŠ¼ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. -->
        </footer>

    </div>

    <script type="module">
        // --- Game State Management ---
        let score = 0;
        let correctAnswer = "";
        let currentMode = null;
        let gameActive = false; 
        let userName = "Explorer"; 
        let synth; // íš¨ê³¼ìŒ ì‹ ë””ì‚¬ì´ì €
        let utterance; // TTS ê°ì²´
        const INITIAL_NAMES = ["Yeonseo", "Yeonjae"]; // ê¸°ë³¸ ì´ë¦„ í›„ë³´
        const INITIAL_NAME_COLOR = 'text-gray-500'; // ë°˜íˆ¬ëª…ì²˜ëŸ¼ ë³´ì¼ ìƒ‰ìƒ (Placeholder style)
        const TYPED_NAME_COLOR = 'text-gray-900'; // ì…ë ¥ëœ í…ìŠ¤íŠ¸ ìƒ‰ìƒ (Opaque)

        // --- Tone.js Sound Setup ---
        function setupSFX() {
            synth = new Tone.Synth({
                oscillator: { type: "sine" },
                envelope: {
                    attack: 0.005,
                    decay: 0.1,
                    sustain: 0.01,
                    release: 0.5
                }
            }).toDestination();
        }

        // --- TTS Setup ---
        function setupTTS() {
            if ('speechSynthesis' in window) {
                utterance = new SpeechSynthesisUtterance();
                utterance.lang = 'en-US'; // ì˜ì–´ ë°œìŒ ì„¤ì •
                window.speechSynthesis.onvoiceschanged = () => {
                     const voices = window.speechSynthesis.getVoices();
                     const englishVoice = voices.find(voice => voice.lang === 'en-US' || voice.lang === 'en_US');
                     if (englishVoice) {
                         utterance.voice = englishVoice;
                     }
                };
            }
        }
        
        function speakQuestion(text) {
            if (window.speechSynthesis && utterance) {
                // ë¹ˆì¹¸ ('___')ì„ 'blank'ë¡œ ì½ì–´ì£¼ë„ë¡ ì¹˜í™˜
                const speechText = text.replace('___', 'blank'); 
                utterance.text = speechText;
                window.speechSynthesis.speak(utterance);
            }
        }


        // --- ORT Sentence/Word Definitions (Stage 1 - 3 Focus) ---
        const SENTENCE_BANK = [
            // Level 1: Simple sight words (is, a, the, look, go)
            { question: "The car is ___.", answer: "red", distractors: ["sit", "run", "him"] },
            { question: "I can ___ the dog.", answer: "see", distractors: ["go", "she", "at"] },
            { question: "___ put the toy in.", answer: "Biff", distractors: ["Mum", "Floppy", "said"] }, // ëª…ì‚¬ ì •ë‹µ ìœ ë„
            { question: "The toy is __ the chair.", answer: "on", distractors: ["big", "in", "it"] },
            { question: "Dad said, '___!'", answer: "Look", distractors: ["Go", "See", "Can"] },
            
            // Level 2: More actions and feelings
            { question: "Kipper is ___.", answer: "happy", distractors: ["said", "away", "sad"] },
            { question: "Floppy ran ___ the road.", answer: "across", distractors: ["up", "in", "to"] },
            { question: "It is __ big.", answer: "too", distractors: ["two", "to", "at"] },
            { question: "The ball went ___.", answer: "up", distractors: ["down", "on", "it"] },
            
            // Level 3: Longer words/sentences and common prepositions
            { question: "The key is ___ the door.", answer: "in", distractors: ["on", "under", "next"] },
            { question: "Dad put the bag ___.", answer: "down", distractors: ["up", "here", "to"] },
            { question: "We can ___ the big slide.", answer: "climb", distractors: ["look", "see", "slow"] },
            { question: "Biff and Chip went ___ to school.", answer: "home", distractors: ["back", "out", "away"] }
        ];

        // --- Mode Definitions ---
        const MODES = {
            'stage1': { name: 'Level 1 (ê¸°ì´ˆ ë‹¨ì–´)', level: 1 },
            'stage2': { name: 'Level 2 (ê°„ë‹¨ ë¬¸ì¥)', level: 2 },
            'stage3': { name: 'Level 3 (ë™ì‘/ë¬˜ì‚¬)', level: 3 },
            'random': { name: 'ëœë¤ ë¯¹ìŠ¤', level: 0 }
        };
        
        // --- DOM Elements ---
        const scoreElement = document.getElementById('score');
        const modeNameElement = document.getElementById('currentModeName');
        const problemDisplay = document.getElementById('problemDisplay');
        const feedbackMessage = document.getElementById('feedbackMessage');
        const buttonContainer = document.getElementById('modeButtons');
        const answerFooter = document.getElementById('answerFooter');
        const gameArea = document.getElementById('gameArea');
        const menuArea = document.getElementById('menuArea');
        const userNameInput = document.getElementById('userNameInput');
        const nameInputArea = document.getElementById('nameInputArea');
        const modeSelectionArea = document.getElementById('modeSelectionArea');
        const welcomeMessage = document.getElementById('welcomeMessage');


        // --- í”¼ë“œë°± ë° ì‘ì› ë©”ì‹œì§€ ---
        function playFeedback(isCorrect) {
            let message;
            
            if (isCorrect) {
                synth.triggerAttackRelease("C5", "8n"); 
                const congrats = ["Perfect!", "Excellent job!", "You got it!", "Amazing!"];
                message = `${userName}, ${congrats[Math.floor(Math.random() * congrats.length)]} âœ¨`;
            } else {
                synth.triggerAttackRelease("C3", "4n"); 
                const encourage = ["Try again!", "Almost there!", "Have another go!", "You can do it!"];
                message = `${userName}, ${encourage[Math.floor(Math.random() * encourage.length)]} âŒ`;
            }
            
            const color = isCorrect ? 'text-green-400' : 'text-red-500';

            feedbackMessage.textContent = message;
            feedbackMessage.className = `text-3xl font-extrabold h-10 ${color}`;

            setTimeout(() => {
                feedbackMessage.textContent = '';
                feedbackMessage.className = `text-3xl font-extrabold h-10`;
            }, 1000);
        }
        
        // --- ì´ë¦„ ì…ë ¥ ì²˜ë¦¬ ë° ë©”ë‰´ í‘œì‹œ ---
        function startNameEntry() {
            // Tone.js ì‹œì‘ (ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ í™œì„±í™”)
            if (Tone.context.state !== 'running') {
                Tone.start();
                setupSFX();
            }

            // ì…ë ¥ í•„ë“œì—ì„œ ê°’ì„ ê°€ì ¸ì˜¬ ë•Œ, í˜„ì¬ ìŠ¤íƒ€ì¼ì´ ê¸°ë³¸ ì´ë¦„ ìŠ¤íƒ€ì¼ì´ë©´ ë¹ˆ ë¬¸ìì—´ë¡œ ì²˜ë¦¬
            let input = userNameInput.value.trim();
            const isPlaceholderStyle = userNameInput.classList.contains(INITIAL_NAME_COLOR);
            
            if (isPlaceholderStyle) {
                // ë°˜íˆ¬ëª… ìŠ¤íƒ€ì¼ ìƒíƒœì¼ ë•Œì˜ ê°’ì€ ì‚¬ìš©ìì—ê²Œ ì˜ë¯¸ìˆëŠ” ì…ë ¥ì´ ì•„ë‹ˆë¯€ë¡œ,
                // ê¸°ë³¸ê°’ì¸ "Yeonseo" ë˜ëŠ” "Yeonjae"ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê²½ê³ 
                if (INITIAL_NAMES.includes(input)) {
                     userName = input; // ë°˜íˆ¬ëª… ìƒíƒœì˜ ê¸°ë³¸ê°’ì„ ì´ë¦„ìœ¼ë¡œ í™•ì •
                } else {
                     alert("Please enter your name!");
                     return;
                }
            } else if (input.length > 0) {
                 userName = input; // ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ì´ë¦„
            } else {
                 alert("Please enter your name!");
                 return;
            }
            
            showModeSelection();
        }
        window.startNameEntry = startNameEntry; 

        function showMenu() {
            gameActive = false;
            gameArea.style.display = 'none';
            answerFooter.style.display = 'none';
            menuArea.style.display = 'block';

            // ì´ˆê¸° ì‹œì‘ ì‹œ ì´ë¦„ ì…ë ¥ í™”ë©´ë¶€í„° ë³´ì—¬ì£¼ê¸°
            nameInputArea.style.display = 'block';
            modeSelectionArea.style.display = 'none';
            welcomeMessage.textContent = "â­ English Word Explorer â­";
            
            // --- ì´ë¦„ ê¸°ë³¸ê°’ ì„¤ì • ë° ë°˜íˆ¬ëª… ìŠ¤íƒ€ì¼ ì ìš© ---
            const defaultName = INITIAL_NAMES[Math.floor(Math.random() * INITIAL_NAMES.length)];
            userNameInput.value = defaultName;
            userNameInput.classList.remove(TYPED_NAME_COLOR);
            userNameInput.classList.add(INITIAL_NAME_COLOR);
            // -------------------------

            score = 0;
            scoreElement.textContent = score;
            modeNameElement.textContent = 'Select Mode';
            feedbackMessage.textContent = '';
        }
        window.showMenu = showMenu;


        // --- ëª¨ë“œ ì„ íƒ í™”ë©´ í‘œì‹œ ---
        function showModeSelection() {
            nameInputArea.style.display = 'none';
            modeSelectionArea.style.display = 'block';
            welcomeMessage.textContent = `ğŸš€ Welcome, ${userName}!`;

            buttonContainer.innerHTML = '';
            
            Object.keys(MODES).forEach(key => {
                const mode = MODES[key];
                const button = document.createElement('button');
                button.textContent = mode.name;
                button.className = 'mode-button p-3 text-lg font-bold text-white rounded-xl';
                button.onclick = () => startGame(key);
                buttonContainer.appendChild(button);
            });
        }


        // --- ê²Œì„ ì‹œì‘ (ëª¨ë“œ ì„ íƒ í›„) ---
        function startGame(modeKey) {
            currentMode = MODES[modeKey];
            modeNameElement.textContent = currentMode.name;
            score = 0;
            scoreElement.textContent = 0;

            gameActive = true;
            menuArea.style.display = 'none';
            gameArea.style.display = 'flex';
            answerFooter.style.display = 'grid';

            generateProblem();
            showMessage(`Let's start, ${userName}!`, 'text-blue-400');
        }


        // --- ë¬¸ì œ ìƒì„± ë¡œì§ ---
        function generateProblem() {
            if (!currentMode) return;
            
            // 1. ë¬¸ì œ ì„ íƒ (ë‚œì´ë„ì— ë”°ë¼ í•„í„°ë§ ê°€ëŠ¥, ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí™”)
            const availableSentences = SENTENCE_BANK; 
            const problemData = availableSentences[Math.floor(Math.random() * availableSentences.length)];
            
            correctAnswer = problemData.answer;
            
            // 2. ë¬¸ì¥ í‘œì‹œ (ë¹ˆì¹¸ ì²˜ë¦¬)
            const displayQuestion = problemData.question.replace('___', '<span class="blank-space">?</span>');
            problemDisplay.innerHTML = displayQuestion;
            
            // 3. TTSë¡œ ë¬¸ì œ ì½ì–´ì£¼ê¸°
            speakQuestion(problemData.question);
            
            // 4. ë‹µë³€ ë²„íŠ¼ ìƒì„±
            generateAnswerButtons(problemData);
        }
        
        // --- ë‹µë³€ ë²„íŠ¼ ìƒì„± ---
        function generateAnswerButtons(problemData) {
            answerFooter.innerHTML = '';
            
            const answers = new Set();
            answers.add(problemData.answer);

            // ì˜¤ë‹µ ì¶”ê°€
            problemData.distractors.forEach(d => answers.add(d));

            // ë°°ì—´ë¡œ ë³€í™˜ í›„ ë¬´ì‘ìœ„ë¡œ ì„ê¸°
            const shuffledAnswers = Array.from(answers).sort(() => Math.random() - 0.5);

            shuffledAnswers.forEach(answer => {
                const button = document.createElement('button');
                button.textContent = answer.toUpperCase(); // ëŒ€ë¬¸ìë¡œ í‘œì‹œ
                button.className = 'answer-button p-4 text-3xl font-bold bg-green-500 hover:bg-green-600 text-white rounded-xl shadow-xl';
                button.onclick = () => checkAnswer(answer);
                answerFooter.appendChild(button);
            });
        }

        // --- ë‹µë³€ í™•ì¸ ---
        function checkAnswer(selectedAnswer) {
            if (!gameActive) return;

            // ë²„íŠ¼ ë¹„í™œì„±í™”
            answerFooter.querySelectorAll('button').forEach(btn => btn.disabled = true);

            const isCorrect = selectedAnswer.toLowerCase() === correctAnswer.toLowerCase();

            if (isCorrect) {
                playFeedback(true);
                score++;
                scoreElement.textContent = score;

                // ì •ë‹µ: ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
                setTimeout(() => {
                    answerFooter.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    generateProblem();
                }, 1000);

            } else {
                playFeedback(false);
                
                // ì˜¤ë‹µ: ì…ë ¥ ì´ˆê¸°í™” ë° ì¬ì‹œë„ ê¸°íšŒ ì œê³µ (ë¬¸ì œëŠ” ìœ ì§€)
                setTimeout(() => {
                    answerFooter.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    showMessage(`Try again, ${userName}!`, "text-yellow-400"); // íŒíŠ¸ ë©”ì‹œì§€
                }, 1000);
            }
        }
        window.checkAnswer = checkAnswer;


        // --- ê¸°íƒ€ ë©”ì‹œì§€ ì¶œë ¥ ---
        function showMessage(text, colorClass) {
            feedbackMessage.textContent = text;
            feedbackMessage.className = `text-3xl font-extrabold h-10 ${colorClass}`;
        }

        // --- ì´ë¦„ ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        function setupInputListeners() {
             // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ: ê¸°ë³¸ ì´ë¦„ ì§€ìš°ê³ , í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì§„í•˜ê²Œ ë³€ê²½
             userNameInput.addEventListener('focus', function() {
                 if (INITIAL_NAMES.includes(this.value) && this.classList.contains(INITIAL_NAME_COLOR)) {
                     this.value = '';
                 }
                 this.classList.remove(INITIAL_NAME_COLOR);
                 this.classList.add(TYPED_NAME_COLOR);
             });
             
             // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ í•´ì œ ì‹œ: ë¹„ì–´ìˆìœ¼ë©´ ê¸°ë³¸ ì´ë¦„ ì¬ì„¤ì • ë° ìŠ¤íƒ€ì¼ ë³µêµ¬
             userNameInput.addEventListener('blur', function() {
                 if (this.value.trim() === '') {
                     const defaultName = INITIAL_NAMES[Math.floor(Math.random() * INITIAL_NAMES.length)];
                     this.value = defaultName;
                     this.classList.remove(TYPED_NAME_COLOR);
                     this.classList.add(INITIAL_NAME_COLOR);
                 }
             });
        }


        // --- ì´ˆê¸°í™” ë° ì‹œì‘ ---
        function initializeGame() {
            // ì†Œë¦¬ ì„¤ì •ì€ ì´ˆê¸°í™” ì‹œ í•œ ë²ˆë§Œ í˜¸ì¶œ
            setupSFX();
            // TTS ì„¤ì • ì¶”ê°€
            setupTTS();
            
            const app = document.getElementById('app');
            app.style.height = `${window.innerHeight}px`;
            window.onresize = () => app.style.height = `${window.innerHeight}px`;
            
            setupInputListeners(); // ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            showMenu();
        }

        window.onload = initializeGame;

    </script>
</body>
</html>
